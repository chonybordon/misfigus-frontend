<analysis>**original_problem_statement:**
The user is building a sticker trading app called MisFigus. The goal is to fix three high-priority issues identified during testing in a single implementation pass.

**PRODUCT REQUIREMENTS (from the latest user request):**

1.  **Fix User Name Display:**
    *   Currently, other users are displayed as a generic Usuario.
    *   This needs to be replaced with the user's actual .
    *   A Complete your profile flow must be enforced on first login if  is missing, requiring a name/nickname.
    *   If a name is not set, the UI should display a fallback like Sin nombre (es) / No name (en), not Usuario.
    *   All parts of the UI (exchanges list, chat, etc.) must use a consistent helper to display the correct name.

2.  **Fix Chat i18n Leak:**
    *   The system message Exchange started. Coordinate your in-person exchange here appears in English, even when the app language is Spanish.
    *   This must be fixed by storing a translatable key (e.g., ) in the database for system messages, instead of the final rendered text. The frontend should then use  to render the correct translation at runtime.

3.  **Fix Album Screen i18n Leaks:**
    *   On the main albums screen, the subtitle (Selecciona un álbum) and category labels (Fútbol, Anime, etc.) remain in Spanish when the language is switched to English.
    *   The hardcoded subtitle must be replaced with an  key.
    *   The backend must be modified to provide a stable  (e.g., , ) for each album, and the frontend must use this key to look up the translated category name.

**User's preferred language**: English. The application's UI is primarily in Spanish, but with English translations. The next agent must respond in **English**.

**what currently exists?**
The application is a full-stack React/FastAPI/MongoDB project. In the last session, the agent implemented a large number of fixes based on user feedback, including:
- A message visibility system with unread indicators on the Exchanges list and a badge on the Album Home page.
- A fix for a navigation loop when going back from the chat screen.
- The addition of non-penalizing failure reasons for exchanges.
- Extensive additions to the  translation files.

The agent ran both backend and frontend testing sub-agents on these fixes, and they passed. However, immediately after, the user provided a new, higher-priority list of three critical issues to be fixed.

**Last working item**:
The agent just began work on a new, three-part task from the user to fix critical UI and i18n issues.

-   **Last item agent was working:** Analyzing the codebase to address the three new high-priority issues: (1) user names displaying as Usuario, (2) English system text leaking into the chat, and (3) untranslated text on the Albums screen. The agent has reviewed  and was about to start implementation.
-   **Status:** NOT STARTED
-   **Agent Testing Done:** N
-   **Which testing method agent to use?** both (Backend changes are needed for data models and API responses; frontend changes are needed for UI rendering and i18n logic).
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
*   **Issue 1: Implement Three Critical Fixes (P0)**
    *   **Description:** The user has mandated that three issues—User Name Display, Chat i18n Leak, and Album Screen i18n—be fixed in a single pass. This is the top priority.
    *   **Status:** NOT STARTED
    *   **Is recurring issue?** Yes (Chat i18n leak).
    *   **Blocked on other issue:** None.
    *   **Issues Detail:** See  section for a breakdown.

*   **Issue 2: Full Verification of Previous Fixes (P1)**
    *   **Description:** A large batch of 7 fixes (message visibility, nav loop, etc.) was coded and passed automated tests, but the user has not verified them. A full, manual end-to-end check of these features is still required after the current P0 task is complete.
    *   **Status:** USER VERIFICATION PENDING
    *   **Is recurring issue?** N
    *   **Should Test frontend/backend/both after fix?** both
    *   **Blocked on other issue:** Implement Three Critical Fixes.

*   **Issue 3: Old Navigation Issue from  (P2)**
    *   **Description:** A low-priority navigation issue was reported in an old test report and has not been addressed.
    *   **Status:** NOT STARTED
    *   **Is recurring issue?** N
    *   **Should Test frontend/backend/both after fix?** frontend
    *   **Blocked on other issue:** None.

**In progress Task List**:
*   None. The current work is defined by the P0 issue.

**Upcoming and Future Tasks**

*   **Upcoming Tasks (Current P0 Task):**
    *   **Task 1 (P0): Fix User Name Display:**
        *   **Backend:** Add  to the  model.
        *   **Backend:** Create a new endpoint or modify an existing one to update the .
        *   **Frontend:** Implement a Complete Profile modal/page that is enforced if  is missing.
        *   **Frontend:** Update all components that show a user's name (, , etc.) to use  with a fallback to an i18n key ().
    *   **Task 2 (P0): Fix Chat i18n Leak:**
        *   **Backend:** Modify the  data structure within an  to store a system message  (e.g., ) instead of hardcoded English text.
        *   **Frontend:** In , check if a message is a system message and use the  to render the text via .
    *   **Task 3 (P0): Fix Album Screen i18n:**
        *   **Backend:** Modify the  endpoint. For each album, return a  (e.g., sports) instead of or in addition to the Spanish category name. Implement a mapping from old Spanish names (Fútbol) to the new keys.
        *   **Frontend:** In , replace the hardcoded Selecciona un álbum subtitle with .
        *   **Frontend:** In , use  to display the translated category name.
        *   **Frontend:** Add all new keys to  for English and Spanish.

*   **Future Tasks:**
    *   Address the old navigation issue from .

**Completed work in this session**
- **Message Visibility Feature:** Implemented backend support ( flags in  model) and two new endpoints (, ). Updated the frontend to show a New Message indicator on exchange cards and a notification badge on the Album home page.
- **Navigation Loop Fix:** Corrected a bug in  that caused a loop when navigating back from the chat screen.
- **Rating Flow Improvement:** Added non-penalizing failure reasons to the backend model.
- **i18n Expansion:** Added a large number of new translation keys to .
- **Automated Testing:** Ran and passed both backend and frontend testing sub-agents for the above fixes.

**Earlier issues found/mentioned but not fixed**
-   **Issue 1: Chat system message localization.**
    -   **Debug checklist:** This was reported in the previous user request. The agent added i18n keys but failed to address the root cause. The user has now specified that the backend is storing the *final text* in the database instead of a *translatable key*. The fix requires changing the data model for system messages.
    -   **Why to solve this issue and what will be achieved with this?** To ensure the chat UI is fully localized and respects the user's language preference.
    -   **Should Test frontend/backend/both after fix:** both
    -   **Is recurring issue?** Y

**Known issue recurrence from previous fork**
- None.

**Code Architecture**


**Key Technical Concepts**
*   **i18n Strategy:** The critical concept for the next task is moving from storing rendered text in the database to storing translatable keys, which are then rendered on the client-side. This applies to both chat messages and album categories.
*   **User Onboarding:** A light Complete Profile flow needs to be implemented.

**key DB schema**
-   **users:** Will require a new  field (string).
-   **exchanges:** Contains  (bool) and  (bool). The  array within will need to be updated to support system message keys.
-   **albums:** The data source for albums will need to be updated to include a  (string).

**changes in tech stack**
- None in the last session.

**All files of reference**
*   : Will need changes for user profile updates and album category keys.
*   : Will need changes for the  model.
*   : Target for i18n fixes.
*   : Target for chat system message fix.
*   : Will need new translation keys.
*   Any component that displays a username will need to be updated (e.g., , ).

**key api endpoints**
*   : Marks messages in a chat as read by the current user.
*   : Gets the number of exchanges with unread messages for an album.
*   : Will need to be modified to return a .
*   A new endpoint will be needed to update a user's .

**Critical Info for New Agent**
*   **Your immediate and only priority is to implement the three fixes from the user's last message (message #87) in a single pass.** Do not work on anything else until this is done.
*   The **chat i18n issue is recurring**. The previous agent's fix was insufficient. The correct solution, as specified by the user, is to change the database to store a translatable *key* for system messages, not the rendered English text.
*   The **user name fix** requires both backend ( field) and frontend (profile completion flow, UI updates) changes. The fallback for a missing name must be Sin nombre / No name, not Usuario.
*   The **album category fix** requires the backend to send a  and the frontend to use it for translation lookups.

**documents and test reports created in this job**
*    (Updated for the previous set of fixes).

**Last 10 User Messages and any pending HUMAN messages**
1.  **USER (Message #5):** Interrupted the agent to report 7 new critical bugs found in testing (A-G), including chat i18n leaks and message visibility issues. Demanded these be fixed first. (COMPLETED by agent, pending user verification).
2.  **USER (Message #8):** Approved the plan to fix the 7 critical bugs and provided strict execution rules and deliverables. (COMPLETED by agent, pending user verification).
3.  **USER (Message #87):** Ignored the agent's completion summary and submitted a new, high-priority request to fix 3 critical issues in one pass: user names showing as Usuario, the recurring chat i18n leak, and i18n leaks on the Albums screen. (PENDING - This is the current task).

**Project Health Check:**
*   **Broken:** The UI currently has significant visual and internationalization bugs that harm the user experience (incorrect names, untranslated text).
*   **Mocked:** No features are currently mocked.

**3rd Party Integrations**
*   **Resend:** For OTP and transactional emails.
*   **react-markdown:** For rendering T&C content.

**Testing status**
-   **Testing agent used after significant changes:** YES (on the previous batch of fixes).
-   **Troubleshoot agent used after agent stuck in loop:** NO.
-   **Test files created:** None.
-   **Known regressions:** The chat system message i18n issue is a known regression/incomplete fix.

**Credentials to test flow:**
*   Use any real email address for OTP login. The code will be sent from .

**What agent forgot to execute**
*   The previous agent failed to correctly diagnose and fix the root cause of the chat system message i18n leak, which required a change to the data being stored in the database.</analysis>
